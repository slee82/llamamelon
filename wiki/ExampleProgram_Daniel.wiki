#summary Daniel’s Example program.
#labels Phase-Design

=I’m working on this.=

=The program:=

{{{
/* Got the calculations from : http://sbs-baseball.com/theory.txt
  Check out http://en.wikipedia.org/wiki/Baseball_statistics*/

/*****************************************************/
/***STATS DEFINITION***/

/*Batter probabilities*/
stat bWalk = BB / PA;
stat bSingle = (Hits - (2B + 3B + HR))/ PA;
stat bDouble = 2B / PA;
stat bTriple = 3B / PA;
stat bHR = HR / PA;

/*Pitcher probabilities*/
stat pWalk = BB / BF;
stat pSingle = (Hits / BF) - pHR - pTriple - pDouble;
stat pDouble = Hits x .174 / BF;
stat pTriple = Hits x .024 / BF;
stat pHR = HR / BF;

/***END STATS DEFINITION***/
/*****************************************************/

/*Global variables that hold combined probabilities given a pitcher and a batter*/
number probWalk = 0;
number probSingle = 0;
number probDouble = 0;
number probTriple = 0;
number probHR = 0;


/*Basic Simulation function: simplifies the problem by pretending that
this is a game between the batter and the pitcher. To further simplify
the problem: let’s assume that a home run is worth 1 point to the batting 
team, singles and walks are worth 1/4 of a point, doubles are 1/2 a point
and triples are 3/4 of a point.*/

simfunction basicSimulation is:

  number team1Score = 0;
  number team2Score = 0;

  /*Note: team1 and team2 are global variables that represent the teams that the
  sim function is currently working with. The sim function sets them automatically.*/

  /*team1 is batting and team2 is pitching! (5 times)*/

  for i from 1 to 5 step 1 do:
    /*Select random players from the best 5 of each team*/
    player batter = any from team1 where (type is "batter" and AVG is top 5);
    player pitcher = any from team2 where (type is "pitcher" and ERA is lowest 5);
    /*I am introducing new conditional shortcuts 'top' and 'lowest' because doing 'AVG > 3.0' might
    not work for a team with bad players (would return no players). I think these keywords come
    in handy for selecting best players, which is something you do a lot when simulating baseball.
    Our language should be good for simulating sports games by providing shortcuts like these*/

    /*Set the global probabilities of this inning*/
    combineProb(batter, pitcher);

    /*Add a little sugar*/
    randomizeProbabilities();

    team1Score += probWalk*(1/4) + probSingle*(1/4) + probDouble*(2/4) + probTriple*(3/4) + probHR;    
  end

  /*NOW, team2 is batting and team1 is pitching! (5 times)*/

  for i from 1 to 5 step 1 do:
    player batter = any from team2 where (type is "batter" and AVG is top 5);
    player pitcher = any from team1 where (type is "pitcher" and ERA is lowest 5);
    
    combineProb(batter, pitcher);

    randomizeProbabilities();

    team2Score += probWalk*(1/4) + probSingle*(1/4) + probDouble*(2/4) + probTriple*(3/4) + probHR;    
  end

  if (team1Score > team2Score) then:
    print "Team " + team1's name + " wins against team " + team2's name + "!!";
    return team1;
  else
    print "Team " + team2's name + " wins against team " + team1's name + "!!";
    return team2;
  end

end


/*Declaring a general-purpose function that calculates
combined probabilities given a pitcher and a batter.
It takes the max of both: average is not a good estimate.*/
function combineProb (player batter, player pitcher) is:

  /*Having Min and Max functions can be useful in situations like these*/
  probWalk = max(pitcher’s pWalk, batter’s bWalk);
  probSingle = max(pitcher’s pSingle, batter’s bSingle);
  probDouble = max(pitcher’s pDouble, batter’s bDouble);
  probTriple = max(pitcher’s pTriple, batter’s bTriple);
  probHR = max(pitcher’s pHR, batter’s bHR);

end

/*General Purpose function that takes the values generated by combineProb and
randomizes them (gives them 10% of jimmy-jammy-ness) for more realistic results*/
function randomizeProbabilities() is:

  probWalk = rand(probWalk - probWalk*.1, probWalk + probWalk*.1);
  probSingle = rand(probSingle - probSingle*.1, probSingle + probSingle*.1);
  probDouble = rand(probDouble - probDouble*.1, probDouble + probDouble*.1);
  probTriple = rand(probTriple - probTriple*.1, probTriple + probTriple*.1);
  probHR = rand(probHR - probHR*.1, probHR + probHR*.1);

end

/*This makes simFunc the active simulation function, for use in the
  following nested simulations (so we don’t have to pass it multiple times).*/
activate basicSimulation;

team winner = sim((Astros, Dodgers, 3), (Orioles, Twins, 3), 3);
print "Team " + winner's name + " has won the championship!!\n";

print "Team " + winner's name + " has the players:";
foreach winner as winnerPlayer do:
  print winnerPlayer's name;
end
}}}


=Program output=

The output will be something like:

{{{
Team Dodgers wins against team Astros!!
Team Orioles wins against team Twins!!
Team Dodgers wins agains team Orioles!!
Team Dodgers has won the championship!!

Team Dodgers has the players:
Ronald Belisario	
Chad Billingsley	
Jonathan Broxton
Scott Elbert
Jon Garland
Charlie Haeger
Clayton Kershaw
Hong-Chih Kuo
Hiroki Kuroda
Brent Leach
James McDonald
Guillermo Mota
etc...
}}}


=Further explanations:=
